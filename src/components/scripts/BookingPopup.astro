---
import { BOOKING_LINK } from '../../config/bookingLink'
---

<div
	id="booking-modal"
	class="booking-modal hidden fixed inset-0 z-[80] items-center justify-center bg-black/70 px-4"
>
	<div class="relative w-full max-w-4xl rounded-2xl bg-white shadow-2xl dark:bg-neutral-900">
		<button
			type="button"
			class="absolute right-4 top-4 inline-flex h-10 w-10 items-center justify-center rounded-full bg-neutral-100 text-neutral-500 transition hover:bg-neutral-200 focus-visible:outline-none dark:bg-neutral-800 dark:text-neutral-200 dark:hover:bg-neutral-700"
			aria-label="Закрыть"
			data-booking-close
		>
			&times;
		</button>
		<iframe
			src={BOOKING_LINK}
			data-booking-iframe
			class="h-[620px] w-full rounded-2xl"
			title="Запись на консультацию"
			loading="lazy"
			referrerpolicy="no-referrer"
		></iframe>
	</div>
</div>

<script>
	const modal = document.getElementById('booking-modal');
	const iframe = modal?.querySelector('[data-booking-iframe]');
	const closeButtons = modal?.querySelectorAll('[data-booking-close]');
	const defaultSrc = iframe?.getAttribute('src') || '';

const openModal = (url?: string) => {
		if (!modal || !iframe) return;
		iframe.setAttribute('src', url || defaultSrc);
		modal.classList.remove('hidden');
		document.body.classList.add('overflow-hidden');
	};

	const closeModal = () => {
		if (!modal || !iframe) return;
		modal.classList.add('hidden');
		document.body.classList.remove('overflow-hidden');
	};

	document.addEventListener('click', (event) => {
		const target = event.target;
		if (!(target instanceof Element)) return;
		const trigger = target.closest('[data-booking-link="true"]');
		if (trigger instanceof HTMLElement) {
			event.preventDefault();
			const link = trigger.getAttribute('data-booking-url') || defaultSrc;
			openModal(link);
		}
	});

	closeButtons?.forEach((button) =>
		button.addEventListener('click', () => {
			closeModal();
		})
	);

	modal?.addEventListener('click', (event) => {
		if (event.target === modal) {
			closeModal();
		}
	});

	document.addEventListener('keydown', (event) => {
		if (event.key === 'Escape') {
			closeModal();
		}
	});
</script>

<style>
	.booking-modal.hidden {
		display: none;
	}
	.booking-modal {
		display: flex;
	}
</style>
