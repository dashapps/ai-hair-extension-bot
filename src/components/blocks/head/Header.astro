---
// Imports
import { ClientRouter } from 'astro:transitions'
import GoogleAnalytics from '../../scripts/googleAnalytics.astro'
import GoogleTagManagerHead from '../../scripts/googleTagManagerHead.astro'
import GoogleSearchConsole from '../../scripts/googleSearchConsole.astro'
// Partials
import Seo from './partials/Seo.astro'
// Data
import { configData } from '../../../config/config'

import { googleAnalyticsMeasurementID } from '../../../config/analytics'
import { googleTagManagerID } from '../../../config/analytics'

// Props
type Props = {
	title?: string
	description?: string
	ogImage?: string
	canonical?: boolean
	noindex?: boolean
}
// Page Metadata
const {
	title = configData.siteTitle,
	description = configData.siteDescription,
	ogImage = configData.ogImage,
	canonical = configData.canonical,
	noindex = configData.noindex
} = Astro.props

const siteOrigin = Astro.url?.origin || import.meta.env.SITE || ''

const resolvedOgImage = (() => {
	if (!ogImage) return ''
	if (/^https?:\/\//i.test(ogImage)) return ogImage
	if (!siteOrigin) return ogImage
	try {
		return new URL(ogImage, siteOrigin).toString()
	} catch {
		return ogImage
	}
})()
const organizationJsonLd = siteOrigin
	? JSON.stringify(
		{
			"@context": 'https://schema.org',
			"@type": 'Organization',
			name: 'Maugli SFD',
			description: configData.siteDescription,
			url: siteOrigin,
			logo: new URL(configData.logo.src, siteOrigin).toString(),
			sameAs: [
				'https://t.me/hair_extension_bot',
				'https://www.linkedin.com/company/maugli-ai/'
			]
		},
		null,
		0
	)
	: ''
---

<head>
	{googleAnalyticsMeasurementID && <GoogleAnalytics />}
	{googleTagManagerID && <GoogleTagManagerHead />}
	<GoogleSearchConsole />
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<Seo
		title={title}
		description={description}
		ogImage={resolvedOgImage}
		canonical={canonical}
		noindex={noindex}
	/>
	<link rel="icon" href={configData.logo.src} type="image/svg+xml" />
	<link rel="sitemap" href="/sitemap-index.xml" />
	<meta name="generator" content={Astro.generator} />
	<link rel="manifest" href="/manifest.webmanifest" />
	<meta name="theme-color" content="#AC9468" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="#AC9468" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
	<!-- Geologica font for headings -->
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Geologica:wght@100..900&display=swap" rel="stylesheet" />
	{organizationJsonLd && (
		<script type="application/ld+json" is:inline set:html={organizationJsonLd}></script>
	)}
	<ClientRouter fallback="swap" />
</head>
